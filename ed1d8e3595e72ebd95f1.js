(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{369:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"reviews",attrs:{id:"reviews"}},[i("div",{staticClass:"reviews__container container"},[e._m(0),1==e.editReviews?i("section",{staticClass:"reviews-edit edit-block__container",attrs:{id:"reviews-edit"}},[i("div",{staticClass:"edit-block"},[e._v("Новый отзыв")]),i("form",{staticClass:"edit__container reviews-edit__block",class:{blocked:e.loading},on:{submit:function(t){return t.preventDefault(),e.newAddReviews(e.newReview)}}},[i("div",{staticClass:"reviews-edit__file form"},[i("div",{staticClass:"file__container"},[i("label",{staticClass:"file__icon",class:{filled:e.renderedPhoto.length},style:e.renderedBackground},[i("input",{staticClass:"reviews__form-file-input",attrs:{type:"file"},on:{change:e.handleFile}}),i("div",{staticClass:"file__icon__svg"})]),i("div",{staticClass:"input-tooltip",class:{"input-tooltip--showed":e.validation.hasError("renderedPhoto")}},[i("div",{staticClass:"erorr___container"},[i("div",{staticClass:"erorr___container__text"},[e._v(e._s(e.validation.firstError("renderedPhoto"))+"                 ")])])]),i("div",{staticClass:"file__title"},[e._v("Добавить фото")])])]),i("div",{staticClass:"reviews-input"},[i("div",{staticClass:"reviews-input__block"},[i("div",{staticClass:"form-add__item reviews--input"},[i("label",{staticClass:"form-label",attrs:{for:"label1"}},[e._v("Имя автора")]),i("div",{staticClass:"input-block__form-add"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newReview.author,expression:"newReview.author"}],staticClass:"input-block input--form-add",attrs:{placeholder:"",id:"label1",type:"text"},domProps:{value:e.newReview.author},on:{input:function(t){t.target.composing||e.$set(e.newReview,"author",t.target.value)}}}),i("div",{staticClass:"input-tooltip",class:{"input-tooltip--showed":e.validation.hasError("newReview.author")}},[i("div",{staticClass:"erorr___container"},[i("div",{staticClass:"erorr___container__text"},[e._v(e._s(e.validation.firstError("newReview.author"))+"                     ")])])])])]),i("div",{staticClass:"form-add__item reviews--input"},[i("label",{staticClass:"form-label",attrs:{for:"label2"}},[e._v("Титул автора")]),i("div",{staticClass:"input-block__form-add"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newReview.occ,expression:"newReview.occ"}],staticClass:"input-block input--form-add",attrs:{placeholder:"",id:"label2",type:"text"},domProps:{value:e.newReview.occ},on:{input:function(t){t.target.composing||e.$set(e.newReview,"occ",t.target.value)}}}),i("div",{staticClass:"input-tooltip",class:{"input-tooltip--showed":e.validation.hasError("newReview.occ")}},[i("div",{staticClass:"erorr___container"},[i("div",{staticClass:"erorr___container__text"},[e._v(e._s(e.validation.firstError("newReview.occ"))+"                                   ")])])])])])]),i("div",{staticClass:"form-add__item"},[i("label",{staticClass:"form-label",attrs:{for:"label3"}},[e._v("Отзывы")]),i("div",{staticClass:"input-block__form-add"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newReview.text,expression:"newReview.text"}],staticClass:"textarea-block textarea--form--add reviews--textarea",domProps:{value:e.newReview.text},on:{input:function(t){t.target.composing||e.$set(e.newReview,"text",t.target.value)}}}),i("div",{staticClass:"input-tooltip",class:{"input-tooltip--showed":e.validation.hasError("newReview.text")}},[i("div",{staticClass:"erorr___container"},[i("div",{staticClass:"erorr___container__text"},[e._v(e._s(e.validation.firstError("newReview.text"))+"                     ")])])])])]),i("div",{staticClass:"form-add__button"},[i("button",{staticClass:"button-no-click form-add--button-no-click",attrs:{type:"reset"},on:{click:e.ResetFormReview}},[e._v("Отмена")]),i("button",{staticClass:"button-click form-add--button-click add-button",attrs:{type:"submit",disabled:e.loading}},[e._v("Сохранить                ")])])])])]):e._e(),i("section",{staticClass:"reviews-list",attrs:{id:"reviews-list"}},[i("div",{staticClass:"reviews-list__container"},[0==e.editReviews?i("div",{staticClass:"work-iteam review-iteam--button"},[i("div",{staticClass:"block-iteam__container"},[i("div",{staticClass:"block-add-button__block"},[i("div",{staticClass:"block-add-button__container block-add-button__container--reviews"},[i("button",{staticClass:"block-add-button",on:{click:function(t){e.editReviews=!0}}},[e._v("+")]),i("div",{staticClass:"block-add-title"},[e._v("Добавить Отзыв")])])])])]):e._e(),e._l(e.reviews,function(t){return i("div",{key:t.id,staticClass:"work-iteam review-iteam"},[i("review-iteam",{attrs:{review:t},on:{editReview:e.editReview}})],1)})],2)])])])};r._withStripped=!0;var s=i(65),a=i(66),n=i.n(a);function o(e,t,i,r,s,a,n){try{var o=e[a](n),c=o.value}catch(e){return void i(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),r.forEach(function(t){l(e,t,i[t])})}return e}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var v=n.a.Validator,d={mixins:[n.a.mixin],data:function(){return{loading:!1,editReviews:!1,renderedPhoto:"",sizePhoto:"",review:{photo:"",author:"",occ:"",text:""},newReview:c({},this.review)}},validators:{"newReview.author":function(e){return v.value(e).required("Введите имя автора")},"newReview.occ":function(e){return v.value(e).required("Введите титул автора")},"newReview.text":function(e){return v.value(e).required("Введите текст отзыва")},renderedPhoto:function(e){return v.value(e).required("Загрузите аватар")}},components:{reviewIteam:function(){return i.e(7).then(i.bind(null,374))}},computed:c({},Object(s.c)("review",{reviews:function(e){return e.reviews}}),Object(s.c)("user",{userID:function(e){return e.user.id}}),{renderedBackground:function(){return this.renderedPhoto?"background-image: url(".concat(this.renderedPhoto,");"):""}}),methods:c({},Object(s.b)("review",["addReview","fetchReview","updateReview"]),{ResetFormReview:function(){this.editReviews=!1,this.review={},this.review.author="",this.review.occ="",this.review.text="",this.newReview=c({},this.review),this.renderedPhoto="",this.validation.reset()},handleFile:function(e){var t=e.target.files[0];this.newReview.photo=t,this.renderImageFile(t)},newAddReviews:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$validate();case 2:if(!e.sent){e.next=27;break}if(this.loading=!0,e.prev=4,!Object.keys(this.newReview).some(function(e){return i.newReview[e]!==i.review[e]})){e.next=14;break}if(!t.id){e.next=12;break}return e.next=10,this.updateReview(t);case 10:e.next=14;break;case 12:return e.next=14,this.addReview(t);case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(4);case 18:return e.prev=18,this.loading=!1,this.editReviews=!1,this.newReview.author="",this.newReview.occ="",this.newReview.text="",this.renderedPhoto="",this.validation.reset(),e.finish(18);case 27:case"end":return e.stop()}},e,this,[[4,16,18,27]])}),function(){var t=this,i=arguments;return new Promise(function(r,s){var a=e.apply(t,i);function n(e){o(a,r,s,n,c,"next",e)}function c(e){o(a,r,s,n,c,"throw",e)}n(void 0)})});return function(e){return t.apply(this,arguments)}}(),renderImageFile:function(e){var t=this,i=new FileReader;try{console.log(e),i.readAsDataURL(e),i.onloadend=function(){t.renderedPhoto=i.result,t.sizePhoto=e.size}}catch(e){throw new Errow("Ошибка при чтении файла")}},editReview:function(e){this.review=e,this.newReview=c({},this.review),this.editReviews=!0,this.review.photo&&(this.renderedPhoto="https://webdev-api.loftschool.com/"+this.review.photo)}}),created:function(){this.fetchReview(this.userID),this.newReview=c({},this.review),this.review.photo&&(this.renderedPhoto="https://webdev-api.loftschool.com/"+this.review.photo)},watch:{review:function(){this.newReview=c({},this.review),this.review.photo&&(this.renderedPhoto="https://webdev-api.loftschool.com/"+this.review.photo)}}},w=i(96),u=Object(w.a)(d,r,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title__container"},[t("h2",{staticClass:"h2__title"},[this._v(" Блок «Отзывы»")])])}],!1,null,null,null);u.options.__file="src/admin/components/pages/reviews/reviews.vue";t.default=u.exports}}]);